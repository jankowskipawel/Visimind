@page "/login"
@using DataLibrary
@using ListsWebApp.Models
@using Microsoft.Extensions.Configuration
@inject Data.LoginState loginState;
@inject IDataAccess _data
@inject IConfiguration _config
@inject Microsoft.AspNetCore.Components.NavigationManager navigationManager


<h3>Login</h3>

@if (!loginState.IsLoggedIn)
{
    <div style="text-align:center">
        <label>Username </label>
        <input id="UserName: " name="UserName" type="text" @bind-value="username" />
    </div>
    <div style=" text-align:center">
        <label>Password </label>
        <input id="Password" name="Password" type="password" @bind-value="password" />
    </div>
    <div style="text-align:center">
        <button type="submit" @onclick=@HandleLogin>
            Submit
        </button>
    </div>
}

@code {
    string username = "";
    string password = "";
    List<User> users;

    async Task HandleLogin()
    {
        string sql = $"select * from users where login = '{username}' and password = '{password}'";
        users = await _data.LoadData<User, dynamic>(sql, new { }, _config.GetConnectionString("default"));
        if (users.Count == 1)
        {
            loginState.SetLogin(true, username, users[0].Id);
            navigationManager.NavigateTo("/lists");
        }
    }

}
